<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CLOCHE | User Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: radial-gradient(circle at 20% 20%, rgba(193, 166, 113, 0.2), rgba(13, 13, 13, 0.95) 45%),
        linear-gradient(180deg, #0d0d0d 0%, #0b0b0b 100%);
      min-height: 100vh;
    }
  </style>
</head>
<body class="text-white">
  <main class="max-w-3xl mx-auto px-6 py-16">
    <div class="border border-[#c1a671]/30 bg-black/40 backdrop-blur-md rounded-2xl p-8">
      <h1 class="text-3xl tracking-[0.2em] mb-2">USER PORTAL</h1>
      <p class="text-[#bab2a0] uppercase tracking-wider text-xs mb-8">Account data loaded from users table</p>

      <div id="status" class="text-sm text-[#c1a671]">Loading your profile...</div>

      <div id="content" class="hidden mt-6 space-y-4">
        <div>
          <p class="text-xs uppercase tracking-widest text-white/60">Name</p>
          <p id="userName" class="text-xl"></p>
        </div>
        <div>
          <p class="text-xs uppercase tracking-widest text-white/60">Email</p>
          <p id="userEmail" class="text-xl"></p>
        </div>
        <div>
          <p class="text-xs uppercase tracking-widest text-white/60">Joined</p>
          <p id="userCreated" class="text-xl"></p>
        </div>
      </div>

      <button id="logoutBtn" class="mt-8 px-6 py-3 bg-[#c1a671] text-black font-bold rounded-lg uppercase tracking-widest text-xs">
        Logout
      </button>
    </div>
  </main>

  <script>
    const userId = localStorage.getItem("userId");
    const statusEl = document.getElementById("status");
    const contentEl = document.getElementById("content");

    function safeSet(id, value) {
      const el = document.getElementById(id);
      if (el) el.textContent = value || "-";
    }

    async function loadUserProfile() {
      if (!userId) {
        statusEl.textContent = "No user session found. Please sign up again.";
        return;
      }

      try {
        const res = await fetch(`/api/auth/user/${userId}`);
        const data = await res.json();

        if (!res.ok) {
          throw new Error(data.message || "Failed to load user profile");
        }

        safeSet("userName", data.name);
        safeSet("userEmail", data.email);
        safeSet("userCreated", new Date(data.created_at).toLocaleString());

        statusEl.classList.add("hidden");
        contentEl.classList.remove("hidden");
      } catch (err) {
        statusEl.textContent = err.message || "Failed to load user profile";
      }
    }

    document.getElementById("logoutBtn").addEventListener("click", () => {
      localStorage.removeItem("isUserLoggedIn");
      localStorage.removeItem("userId");
      localStorage.removeItem("userName");
      localStorage.removeItem("userEmail");
      window.location.href = "signup.html";
    });

    loadUserProfile();
  </script>
</body>
</html>

